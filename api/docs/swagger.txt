openapi: 3.0.1
info:
  title: Movie Recommendation API
  description: API для работы с рекомендациями фильмов, сессиями пользователей и управлением избранным.
  version: 1.0.0
servers:
  - url: https://d5d30qf1gfnohkmkl679.apigw.yandexcloud.net
    description: Основной сервер API
paths:
  /create_session:
    post:
      summary: Создание сессии для пользователя
      description: Создаёт сессию для пользователя с заданным chat_id и user_name.
      operationId: createSession
      requestBody:
        description: Данные для создания сессии
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                chat_id:
                  type: string
                user_name:
                  type: string
              required:
                - chat_id
                - user_name
      responses:
        '200':
          description: Сессия успешно создана
          content:
            application/json:
              schema:
                type: object
                properties:
                  session_id:
                    type: string
        '400':
          description: Ошибка - отсутствуют обязательные параметры
        '500':
          description: Ошибка сервера

  /approve_session:
    post:
      summary: Присоединение к сессии
      description: Позволяет пользователю присоединиться к существующей сессии.
      operationId: approveSession
      requestBody:
        description: Данные для присоединения к сессии
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                chat_id:
                  type: string
                user_name:
                  type: string
                session_id:
                  type: string
              required:
                - chat_id
                - user_name
                - session_id
      responses:
        '200':
          description: Успешное присоединение
          content:
            application/json:
              schema:
                type: object
                properties:
                  owner:
                    type: string
        '400':
          description: Ошибка - отсутствуют обязательные параметры
        '500':
          description: Ошибка сервера

  /get_recommendation:
    get:
      summary: Получение случайной рекомендации фильма
      description: Возвращает случайный фильм.
      operationId: getRecommendation
      responses:
        '200':
          description: Случайный фильм
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  name:
                    type: string
                  description:
                    type: string

  /send_recommendation_opinion:
    post:
      summary: Отправка мнения о фильме
      description: Пользователь отправляет свое мнение о фильме в рамках сессии.
      operationId: sendRecommendationOpinion
      requestBody:
        description: Данные мнения о фильме
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                chat_id:
                  type: string
                film_id:
                  type: string
                session_id:
                  type: string
                opinion:
                  type: string
              required:
                - chat_id
                - film_id
                - session_id
                - opinion
      responses:
        '200':
          description: Мнение обновлено, совпадение предпочтений проверено
          content:
            application/json:
              schema:
                type: object
                properties:
                  chat_id_1:
                    type: string
                  chat_id_2:
                    type: string
                  match:
                    type: boolean
        '400':
          description: Ошибка - отсутствуют обязательные параметры
        '500':
          description: Ошибка сервера

  /check_match:
    get:
      summary: Проверка на совпадение предпочтений
      description: Проверяет наличие совпадений предпочтений пользователей по session_id и film_id.
      operationId: checkMatch
      parameters:
        - in: query
          name: session_id
          required: true
          schema:
            type: string
        - in: query
          name: film_id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Результат проверки совпадений
          content:
            application/json:
              schema:
                type: object
                properties:
                  match:
                    type: boolean

  /add_favorite:
    post:
      summary: Добавление фильма в избранное
      description: Добавляет фильм в список избранных пользователя.
      operationId: addFavorite
      requestBody:
        description: Данные фильма для добавления в избранное
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                chat_id:
                  type: string
                film_id:
                  type: string
                film_name:
                  type: string
                film_description:
                  type: string
              required:
                - chat_id
                - film_id
                - film_name
                - film_description
      responses:
        '200':
          description: Фильм успешно добавлен в избранное

  /get_favorites:
    get:
      summary: Получение списка избранных фильмов
      description: Возвращает все избранные фильмы для заданного пользователя.
      operationId: getFavorites
      parameters:
        - in: query
          name: chat_id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Список избранных фильмов
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: array
                    items:
                      type: object
                      properties:
                        film_id:
                          type: string
                        film_name:
                          type: string
                        film_description:
                          type: string

  /get_movies_by_description:
    get:
      summary: Поиск фильмов по описанию
      description: Ищет фильмы по описанию через API Яндекса.
      operationId: getMoviesByDescription
      parameters:
        - in: query
          name: description
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Результаты поиска
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: array
                    items:
                      type: object
                      properties:
                        film_id:
                          type: string
                        film_name:
                          type: string
                        film_description:
                          type: string

  /get_random_movie_by_genre:
    get:
      summary: Получение случайного фильма по жанру
      description: Возвращает случайный фильм по заданному жанру.
      operationId: getRandomMovieByGenre
      parameters:
        - in: query
          name: genre
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Случайный фильм по жанру
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  name:
                    type: string
                  description:
                    type: string

  /send_rating:
    post:
      summary: Отправка рейтинга фильма
      description: Пользователь выставляет рейтинг для фильма.
      operationId: sendRating
      requestBody:
        description: Данные для выставления рейтинга
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                chat_id:
                  type: string
                film_id:
                  type: string
                film_name:
                  type: string
                rating:
                  type: integer
                  minimum: 1
                  maximum: 5
              required:
                - chat_id
                - film_id
                - film_name
                - rating
      responses:
        '200':
          description: Рейтинг успешно отправлен

  /get_rating:
    get:
      summary: Получение рейтингов пользователя
      description: Возвращает все оценки пользователя для фильмов.
      operationId: getRating
      parameters:
        - in: query
          name: chat_id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Рейтинг пользователя
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: array
                    items:
                      type: object
                      properties:
                        film_id:
                          type: string
                        film_name:
                          type: string
                        rating:
                          type: integer

components:
  schemas:
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
